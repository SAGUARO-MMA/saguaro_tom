{% extends 'tom_common/index.html' %}
{% load bootstrap4 %}
{% block title %}GW Events{% endblock %}
{% block content %}
<div class="row">
    <div class="col-md-6"><h1>GW Event Index</h1></div>
    <div class="col-md-6 d-flex justify-content-end align-items-baseline">
    {% if request.GET.hide_test_alerts %}
        <a href="{% url 'custom_code:nonlocalizedevents' %}" class="btn btn-secondary" title="Show">Show Test Alerts</a>
    {% else %}
        <a href="{% url 'custom_code:nonlocalizedevents' %}?hide_test_alerts=on" class="btn btn-secondary" title="Hide">Hide Test Alerts</a>
    {% endif %}
    </div>
</div>
{% if object_list %}
  <table class="table">
      <thead>
      <tr>
        <th scope="col">Detail Page</th>
        <th scope="col">Significance</th>
        <th scope="col">Group</th>
        <th scope="col">HasNS</th>
        <th scope="col">HasRemnant</th>
        <th scope="col">CSS Fields</th>
        <th scope="col">Candidates</th>
        <th scope="col">Hermes</th>
        <th scope="col">GraceDB</th>
        <th scope="col">Treasure Map</th>
      </tr>
      </thead>
      <tbody>
      {% for event in object_list %}
      <tr>
        <td>
            <a href="{% url 'nonlocalizedevents:event-detail'  event.event_id %}" target="_blank"><b>{{ event.event_id }}</b></a>
        </td>
        <td>
            {% if event.sequences.last.details.significant %}
            Significant
            {% else %}
            Subthreshold
            {% endif %}
        </td>
        <td>{{ event.sequences.last.details.group }}</td>
        <td>{{ event.sequences.last.details.properties.HasNS | floatformat:"2" }}</td>
        <td>{{ event.sequences.last.details.properties.HasRemnant | floatformat:"2" }}</td>
        <td>
        {% for localization in event.localizations.all|dictsort:"id" %}
            <a href="{% url 'custom_code:css-fields' localization.id %}?grouping_ngroups=3&grouping_nfields=12" target="_blank">
                {% if localization.external_coincidences.exists %}
                    {{ localization.external_coincidences.last.sequences.last.sequence_id }}c
                {% else %}
                    {{ localization.sequences.last.sequence_id }}
                {% endif %}
            </a>
        {% endfor %}
        </td>
        <td>
            <a href="{% url 'custom_code:candidates' %}?localization_event={{ event.event_id }}&localization_prob=95&localization_dt=3&order=-mlscore_real" target="_blank">Candidates</a>
        </td>
        <td>
          <a href="{{ event.hermes_url }}" target="_blank">Hermes</a>
        </td>
        <td>
          <a href="{{ event.gracedb_url }}" target="_blank">GraceDB</a>
        </td>
        <td>
            <a href="{{ event.treasuremap_url }}" target="_blank">Treasure Map</a>
        </td>
      </tr>
      {% endfor %}
      </tbody>
  </table>
{% else %}
    <p>No events have been created. Create Superevents via the admin interface, the REST API,
        or the readstreams management command.</p>
    <p>Coming soon: event creation from the <a href="{% url 'tom_alerts:list' %}">HERMES Alert Broker</a>.</p>
{% endif %}

{% endblock content %}
